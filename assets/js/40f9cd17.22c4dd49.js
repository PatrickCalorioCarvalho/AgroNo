"use strict";(globalThis.webpackChunkagrono_docs=globalThis.webpackChunkagrono_docs||[]).push([[3185],{6551(e,r,n){n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>t});const o=JSON.parse('{"id":"nodes/soil-sensor","title":"Sensor de Solo","description":"Sensor de Solo","source":"@site/docs/nodes/soil-sensor.md","sourceDirName":"nodes","slug":"/nodes/soil-sensor","permalink":"/AgroNo/docs/nodes/soil-sensor","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Armadilha de Insetos","permalink":"/AgroNo/docs/nodes/insect-trap"},"next":{"title":"Gateway AgroN\xf3","permalink":"/AgroNo/docs/gateway"}}');var a=n(4848),s=n(8453);const i={},d="Sensor de Solo",l={},t=[{value:"Hardware",id:"hardware",level:2},{value:"Software",id:"software",level:2},{value:"L\xf3gica de Funcionamento",id:"l\xf3gica-de-funcionamento",level:3},{value:"C\xf3digo Principal (Pseudoc\xf3digo)",id:"c\xf3digo-principal-pseudoc\xf3digo",level:3},{value:"Formato de Dados",id:"formato-de-dados",level:2},{value:"Gateway - Processamento",id:"gateway---processamento",level:2},{value:"C\xf3digo Espec\xedfico",id:"c\xf3digo-espec\xedfico",level:3},{value:"API do Servidor",id:"api-do-servidor",level:2},{value:"Endpoint: POST /api/dados",id:"endpoint-post-apidados",level:3},{value:"Pr\xf3ximos Passos",id:"pr\xf3ximos-passos",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"sensor-de-solo",children:"Sensor de Solo"})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{src:"/AgroNo/img/soil-sensor.svg",alt:"Sensor de Solo"})}),"\n",(0,a.jsx)(r.p,{children:"O sensor de solo monitora par\xe2metros importantes para agricultura como umidade, temperatura do solo, pH e condutividade el\xe9trica (salinidade)."}),"\n",(0,a.jsx)(r.h2,{id:"hardware",children:"Hardware"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Microcontrolador"}),": ESP32"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Sensores"}),":","\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Sensor de umidade do solo (capacitivo ou resistivo)"}),"\n",(0,a.jsx)(r.li,{children:"Termistor ou DS18B20 (temperatura do solo)"}),"\n",(0,a.jsx)(r.li,{children:"Sensor pH"}),"\n",(0,a.jsx)(r.li,{children:"Sensor de condutividade el\xe9trica"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"R\xe1dio"}),": NRF24L01+ ou SX1276 (LoRa)"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Energia"}),": Bateria LiPo 18650 + Painel Solar 5V"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Caixa"}),": IP68 para enterramento parcial"]}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"software",children:"Software"}),"\n",(0,a.jsx)(r.h3,{id:"l\xf3gica-de-funcionamento",children:"L\xf3gica de Funcionamento"}),"\n",(0,a.jsx)(r.mermaid,{value:"stateDiagram-v2\r\n    [*] --\x3e Inicializa\xe7\xe3o\r\n    Inicializa\xe7\xe3o --\x3e CalibrarSensores\r\n    CalibrarSensores --\x3e LerSensores\r\n    LerSensores --\x3e ProcessarDados\r\n    ProcessarDados --\x3e EnviarDados\r\n    EnviarDados --\x3e DeepSleep\r\n    DeepSleep --\x3e Acordar: Timer\r\n    Acordar --\x3e LerSensores"}),"\n",(0,a.jsx)(r.h3,{id:"c\xf3digo-principal-pseudoc\xf3digo",children:"C\xf3digo Principal (Pseudoc\xf3digo)"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-cpp",children:'#include <ESP32WiFi.h>\r\n#include <RF24.h>\r\n#include <OneWire.h>\r\n#include <DallasTemperature.h>\r\n\r\n// Configura\xe7\xf5es\r\n#define NODE_ID "SOL_01"\r\n#define SOIL_MOISTURE_PIN 34\r\n#define SOIL_TEMP_PIN 4\r\n#define PH_PIN 35\r\n#define EC_PIN 32\r\n#define RADIO_CE 22\r\n#define RADIO_CS 21\r\n\r\nRF24 radio(RADIO_CE, RADIO_CS);\r\nOneWire oneWire(SOIL_TEMP_PIN);\r\nDallasTemperature sensors(&oneWire);\r\n\r\nvoid setup() {\r\n    Serial.begin(115200);\r\n    sensors.begin();\r\n    radio.begin();\r\n    radio.setChannel(76);\r\n    radio.openWritingPipe(0xF0F0F0F0E1LL);\r\n    radio.setPALevel(RF24_PA_LOW);\r\n    radio.stopListening();\r\n}\r\n\r\nvoid loop() {\r\n    // Ler sensores\r\n    int moistureRaw = analogRead(SOIL_MOISTURE_PIN);\r\n    float moisture = map(moistureRaw, 0, 4095, 0, 100);  // Calibrar\r\n\r\n    sensors.requestTemperatures();\r\n    float soilTemp = sensors.getTempCByIndex(0);\r\n\r\n    int phRaw = analogRead(PH_PIN);\r\n    float ph = map(phRaw, 0, 4095, 0, 14);  // Calibrar\r\n\r\n    int ecRaw = analogRead(EC_PIN);\r\n    float ec = map(ecRaw, 0, 4095, 0, 2000);  // Calibrar em \xb5S/cm\r\n\r\n    // Formatar JSON\r\n    String data = "{";\r\n    data += "\\"node_id\\":\\"" + String(NODE_ID) + "\\",";\r\n    data += "\\"tipo\\":\\"solo\\",";\r\n    data += "\\"umidade\\":" + String(moisture) + ",";\r\n    data += "\\"temperatura_solo\\":" + String(soilTemp) + ",";\r\n    data += "\\"ph\\":" + String(ph) + ",";\r\n    data += "\\"condutividade\\":" + String(ec) + ",";\r\n    data += "\\"timestamp\\":\\"" + getTimestamp() + "\\",";\r\n    data += "\\"sync\\":false";\r\n    data += "}";\r\n\r\n    // Enviar via r\xe1dio\r\n    radio.write(data.c_str(), data.length());\r\n\r\n    // Deep Sleep por 30 minutos\r\n    esp_sleep_enable_timer_wakeup(30 * 60 * 1000000);\r\n    esp_deep_sleep_start();\r\n}\r\n\r\nString getTimestamp() {\r\n    return "2025-12-28T10:00:00";\r\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"formato-de-dados",children:"Formato de Dados"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-json",children:'{\r\n  "node_id": "SOL_01",\r\n  "tipo": "solo",\r\n  "umidade": 45.2,\r\n  "temperatura_solo": 22.5,\r\n  "ph": 6.8,\r\n  "condutividade": 850,\r\n  "timestamp": "2025-12-28T10:00:00",\r\n  "sync": false\r\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"gateway---processamento",children:"Gateway - Processamento"}),"\n",(0,a.jsx)(r.p,{children:"O gateway pode agregar dados por zona de irriga\xe7\xe3o."}),"\n",(0,a.jsx)(r.h3,{id:"c\xf3digo-espec\xedfico",children:"C\xf3digo Espec\xedfico"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:"def processar_solo(dados):\r\n    # Calcular m\xe9dias por hora\r\n    hora = dados['timestamp'][:13]  # YYYY-MM-DDTHH\r\n    cursor.execute('''INSERT INTO medias_solo (node_id, hora, umidade_avg, temp_avg, ph_avg, ec_avg, count)\r\n                      VALUES (?, ?, ?, ?, ?, ?, 1)\r\n                      ON CONFLICT(node_id, hora) DO UPDATE SET\r\n                      umidade_avg = (umidade_avg * count + ?) / (count + 1),\r\n                      temp_avg = (temp_avg * count + ?) / (count + 1),\r\n                      ph_avg = (ph_avg * count + ?) / (count + 1),\r\n                      ec_avg = (ec_avg * count + ?) / (count + 1),\r\n                      count = count + 1''',\r\n                   (dados['node_id'], hora, dados['umidade'], dados['temperatura_solo'], dados['ph'], dados['condutividade'],\r\n                    dados['umidade'], dados['temperatura_solo'], dados['ph'], dados['condutividade']))\r\n    conn.commit()\n"})}),"\n",(0,a.jsx)(r.h2,{id:"api-do-servidor",children:"API do Servidor"}),"\n",(0,a.jsx)(r.h3,{id:"endpoint-post-apidados",children:"Endpoint: POST /api/dados"}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"Exemplo de Request:"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-json",children:'{\r\n  "node_id": "SOL_01",\r\n  "tipo": "solo",\r\n  "umidade": 45.2,\r\n  "temperatura_solo": 22.5,\r\n  "ph": 6.8,\r\n  "condutividade": 850,\r\n  "timestamp": "2025-12-28T10:00:00",\r\n  "sync": false\r\n}\n'})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"Resposta:"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "message": "Dados de solo registrados"\r\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"pr\xf3ximos-passos",children:"Pr\xf3ximos Passos"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Calibra\xe7\xe3o precisa dos sensores"}),"\n",(0,a.jsx)(r.li,{children:"Adicionar sensor de nitrog\xeanio (NDVI)"}),"\n",(0,a.jsx)(r.li,{children:"Integra\xe7\xe3o com sistemas de irriga\xe7\xe3o"}),"\n",(0,a.jsx)(r.li,{children:"Alertas para condi\xe7\xf5es cr\xedticas do solo"}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);