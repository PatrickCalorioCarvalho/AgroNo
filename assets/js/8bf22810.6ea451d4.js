"use strict";(globalThis.webpackChunkagrono_docs=globalThis.webpackChunkagrono_docs||[]).push([[1848],{1357(e,r,n){n.r(r),n.d(r,{assets:()=>t,contentTitle:()=>d,default:()=>p,frontMatter:()=>s,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"nodes/weather-station","title":"Esta\xe7\xe3o Meteorol\xf3gica","description":"Esta\xe7\xe3o Meteorol\xf3gica","source":"@site/docs/nodes/weather-station.md","sourceDirName":"nodes","slug":"/nodes/weather-station","permalink":"/AgroNo/docs/nodes/weather-station","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"N\xf3s IoT do AgroN\xf3","permalink":"/AgroNo/docs/nodes/"},"next":{"title":"Armadilha de Insetos","permalink":"/AgroNo/docs/nodes/insect-trap"}}');var a=n(4848),i=n(8453);const s={},d="Esta\xe7\xe3o Meteorol\xf3gica",t={},l=[{value:"Hardware",id:"hardware",level:2},{value:"Software",id:"software",level:2},{value:"L\xf3gica de Funcionamento",id:"l\xf3gica-de-funcionamento",level:3},{value:"C\xf3digo Principal (Pseudoc\xf3digo)",id:"c\xf3digo-principal-pseudoc\xf3digo",level:3},{value:"Formato de Dados",id:"formato-de-dados",level:2},{value:"Gateway - Processamento",id:"gateway---processamento",level:2},{value:"C\xf3digo Gateway (Python com Raspberry Pi)",id:"c\xf3digo-gateway-python-com-raspberry-pi",level:3},{value:"API do Servidor",id:"api-do-servidor",level:2},{value:"Endpoint: POST /api/dados",id:"endpoint-post-apidados",level:3},{value:"Pr\xf3ximos Passos",id:"pr\xf3ximos-passos",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"esta\xe7\xe3o-meteorol\xf3gica",children:"Esta\xe7\xe3o Meteorol\xf3gica"})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{src:"/AgroNo/img/weather-station.svg",alt:"Esta\xe7\xe3o Meteorol\xf3gica"})}),"\n",(0,a.jsx)(r.p,{children:"A esta\xe7\xe3o meteorol\xf3gica \xe9 um n\xf3 IoT respons\xe1vel por coletar dados ambientais como temperatura, umidade, press\xe3o atmosf\xe9rica, velocidade do vento e precipita\xe7\xe3o."}),"\n",(0,a.jsx)(r.h2,{id:"hardware",children:"Hardware"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Microcontrolador"}),": ESP32"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Sensores"}),":","\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"DHT22 ou BME280 (temperatura, umidade)"}),"\n",(0,a.jsx)(r.li,{children:"BMP180 ou BME280 (press\xe3o)"}),"\n",(0,a.jsx)(r.li,{children:"Anem\xf4metro (velocidade do vento)"}),"\n",(0,a.jsx)(r.li,{children:"Pluvi\xf4metro (precipita\xe7\xe3o)"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"R\xe1dio"}),": NRF24L01+ ou SX1276 (LoRa)"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Energia"}),": Bateria LiPo 18650 + Painel Solar 5V"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Caixa"}),": IP65 para prote\xe7\xe3o externa"]}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"software",children:"Software"}),"\n",(0,a.jsx)(r.h3,{id:"l\xf3gica-de-funcionamento",children:"L\xf3gica de Funcionamento"}),"\n",(0,a.jsx)(r.mermaid,{value:"stateDiagram-v2\r\n    [*] --\x3e Inicializa\xe7\xe3o\r\n    Inicializa\xe7\xe3o --\x3e DeepSleep: Configurado\r\n    DeepSleep --\x3e Acordar: Timer ou Evento\r\n    Acordar --\x3e LerSensores\r\n    LerSensores --\x3e ProcessarDados\r\n    ProcessarDados --\x3e EnviarDados\r\n    EnviarDados --\x3e DeepSleep"}),"\n",(0,a.jsx)(r.h3,{id:"c\xf3digo-principal-pseudoc\xf3digo",children:"C\xf3digo Principal (Pseudoc\xf3digo)"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-cpp",children:'#include <ESP32WiFi.h>\r\n#include <RF24.h>\r\n#include <DHT.h>\r\n#include <Wire.h>\r\n#include <Adafruit_BMP280.h>\r\n\r\n// Configura\xe7\xf5es\r\n#define NODE_ID "MET_01"\r\n#define DHT_PIN 4\r\n#define RADIO_CE 22\r\n#define RADIO_CS 21\r\n\r\nRF24 radio(RADIO_CE, RADIO_CS);\r\nDHT dht(DHT_PIN, DHT22);\r\nAdafruit_BMP280 bmp;\r\n\r\nvoid setup() {\r\n    Serial.begin(115200);\r\n    dht.begin();\r\n    bmp.begin(0x76);\r\n    radio.begin();\r\n    radio.setChannel(76);\r\n    radio.openWritingPipe(0xF0F0F0F0E1LL);\r\n    radio.setPALevel(RF24_PA_LOW);\r\n    radio.stopListening();\r\n}\r\n\r\nvoid loop() {\r\n    // Ler sensores\r\n    float temp = dht.readTemperature();\r\n    float hum = dht.readHumidity();\r\n    float press = bmp.readPressure() / 100.0F;\r\n    // Simular vento e chuva (sensores reais necess\xe1rios)\r\n    float wind = random(0, 50);\r\n    float rain = random(0, 10);\r\n\r\n    // Formatar JSON\r\n    String data = "{";\r\n    data += "\\"node_id\\":\\"" + String(NODE_ID) + "\\",";\r\n    data += "\\"tipo\\":\\"meteorologia\\",";\r\n    data += "\\"temperatura\\":" + String(temp) + ",";\r\n    data += "\\"umidade\\":" + String(hum) + ",";\r\n    data += "\\"pressao\\":" + String(press) + ",";\r\n    data += "\\"vento\\":" + String(wind) + ",";\r\n    data += "\\"chuva\\":" + String(rain) + ",";\r\n    data += "\\"timestamp\\":\\"" + getTimestamp() + "\\",";\r\n    data += "\\"sync\\":false";\r\n    data += "}";\r\n\r\n    // Enviar via r\xe1dio\r\n    radio.write(data.c_str(), data.length());\r\n\r\n    // Deep Sleep por 10 minutos\r\n    esp_sleep_enable_timer_wakeup(10 * 60 * 1000000);\r\n    esp_deep_sleep_start();\r\n}\r\n\r\nString getTimestamp() {\r\n    // Implementar NTP ou RTC\r\n    return "2025-12-28T10:00:00";\r\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"formato-de-dados",children:"Formato de Dados"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-json",children:'{\r\n  "node_id": "MET_01",\r\n  "tipo": "meteorologia",\r\n  "temperatura": 25.5,\r\n  "umidade": 65.2,\r\n  "pressao": 1013.25,\r\n  "vento": 12.5,\r\n  "chuva": 0.0,\r\n  "timestamp": "2025-12-28T10:00:00",\r\n  "sync": false\r\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"gateway---processamento",children:"Gateway - Processamento"}),"\n",(0,a.jsx)(r.p,{children:"O gateway recebe os dados via r\xe1dio e os processa da seguinte forma:"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Recep\xe7\xe3o"}),": Escuta continuamente no canal de r\xe1dio"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Valida\xe7\xe3o"}),": Verifica integridade do JSON"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Armazenamento"}),": Salva em buffer local (SQLite ou JSON)"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Sincroniza\xe7\xe3o"}),": Quando online, envia para API do servidor"]}),"\n"]}),"\n",(0,a.jsx)(r.h3,{id:"c\xf3digo-gateway-python-com-raspberry-pi",children:"C\xf3digo Gateway (Python com Raspberry Pi)"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:"import json\r\nimport sqlite3\r\nimport requests\r\nfrom RF24 import RF24\r\n\r\n# Configura\xe7\xf5es\r\nDB_PATH = 'agrono.db'\r\nAPI_URL = 'http://servidor-agrono.com/api/dados'\r\n\r\nradio = RF24(22, 0)  # GPIO 22 CE, SPI CE0\r\nradio.begin()\r\nradio.setChannel(76)\r\nradio.openReadingPipe(1, 0xF0F0F0F0E1LL)\r\nradio.startListening()\r\n\r\nconn = sqlite3.connect(DB_PATH)\r\ncursor = conn.cursor()\r\ncursor.execute('''CREATE TABLE IF NOT EXISTS dados (\r\n    id INTEGER PRIMARY KEY,\r\n    node_id TEXT,\r\n    tipo TEXT,\r\n    dados TEXT,\r\n    timestamp TEXT,\r\n    sync INTEGER DEFAULT 0\r\n)''')\r\n\r\ndef salvar_dados(dados):\r\n    cursor.execute('INSERT INTO dados (node_id, tipo, dados, timestamp) VALUES (?, ?, ?, ?)',\r\n                   (dados['node_id'], dados['tipo'], json.dumps(dados), dados['timestamp']))\r\n    conn.commit()\r\n\r\ndef sincronizar():\r\n    cursor.execute('SELECT * FROM dados WHERE sync = 0')\r\n    rows = cursor.fetchall()\r\n    for row in rows:\r\n        try:\r\n            response = requests.post(API_URL, json=json.loads(row[3]))\r\n            if response.status_code == 200:\r\n                cursor.execute('UPDATE dados SET sync = 1 WHERE id = ?', (row[0],))\r\n        except:\r\n            pass  # Tentar novamente depois\r\n    conn.commit()\r\n\r\nwhile True:\r\n    if radio.available():\r\n        length = radio.getDynamicPayloadSize()\r\n        received_payload = radio.read(length)\r\n        try:\r\n            dados = json.loads(received_payload.decode())\r\n            salvar_dados(dados)\r\n        except:\r\n            pass  # Dados inv\xe1lidos\r\n\r\n    # Sincronizar periodicamente\r\n    sincronizar()\r\n    time.sleep(60)  # A cada minuto\n"})}),"\n",(0,a.jsx)(r.h2,{id:"api-do-servidor",children:"API do Servidor"}),"\n",(0,a.jsx)(r.h3,{id:"endpoint-post-apidados",children:"Endpoint: POST /api/dados"}),"\n",(0,a.jsx)(r.p,{children:"Recebe os dados dos n\xf3s via gateway."}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"Exemplo de Request:"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-json",children:'{\r\n  "node_id": "MET_01",\r\n  "tipo": "meteorologia",\r\n  "temperatura": 25.5,\r\n  "umidade": 65.2,\r\n  "pressao": 1013.25,\r\n  "vento": 12.5,\r\n  "chuva": 0.0,\r\n  "timestamp": "2025-12-28T10:00:00",\r\n  "sync": false\r\n}\n'})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"Resposta:"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "message": "Dados recebidos"\r\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"pr\xf3ximos-passos",children:"Pr\xf3ximos Passos"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Implementar sensores reais para vento e chuva"}),"\n",(0,a.jsx)(r.li,{children:"Adicionar GPS para localiza\xe7\xe3o"}),"\n",(0,a.jsx)(r.li,{children:"Calibra\xe7\xe3o e valida\xe7\xe3o de dados"}),"\n",(0,a.jsx)(r.li,{children:"Testes em campo"}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);