"use strict";(globalThis.webpackChunkagrono_docs=globalThis.webpackChunkagrono_docs||[]).push([[3517],{4206(e,n,r){r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>s,default:()=>p,frontMatter:()=>d,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"nodes/insect-trap","title":"Armadilha de Insetos","description":"Armadilha de Insetos","source":"@site/docs/nodes/insect-trap.md","sourceDirName":"nodes","slug":"/nodes/insect-trap","permalink":"/AgroNo/docs/nodes/insect-trap","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Esta\xe7\xe3o Meteorol\xf3gica","permalink":"/AgroNo/docs/nodes/weather-station"},"next":{"title":"Sensor de Solo","permalink":"/AgroNo/docs/nodes/soil-sensor"}}');var o=r(4848),i=r(8453);const d={},s="Armadilha de Insetos",t={},l=[{value:"Hardware",id:"hardware",level:2},{value:"Software",id:"software",level:2},{value:"L\xf3gica de Funcionamento",id:"l\xf3gica-de-funcionamento",level:3},{value:"C\xf3digo Principal (Pseudoc\xf3digo)",id:"c\xf3digo-principal-pseudoc\xf3digo",level:3},{value:"Formato de Dados",id:"formato-de-dados",level:2},{value:"Gateway - Processamento",id:"gateway---processamento",level:2},{value:"C\xf3digo Espec\xedfico",id:"c\xf3digo-espec\xedfico",level:3},{value:"API do Servidor",id:"api-do-servidor",level:2},{value:"Endpoint: POST /api/dados",id:"endpoint-post-apidados",level:3},{value:"Pr\xf3ximos Passos",id:"pr\xf3ximos-passos",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"armadilha-de-insetos",children:"Armadilha de Insetos"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"/AgroNo/img/insect-trap.svg",alt:"Armadilha de Insetos"})}),"\n",(0,o.jsx)(n.p,{children:"A armadilha de insetos \xe9 um dispositivo automatizado para monitoramento de pragas agr\xedcolas. Conta insetos capturados e envia dados periodicamente."}),"\n",(0,o.jsx)(n.h2,{id:"hardware",children:"Hardware"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Microcontrolador"}),": ESP32"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Sensores"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Sensor infravermelho (IR) ou fotoc\xe9lula para detec\xe7\xe3o de passagem"}),"\n",(0,o.jsx)(n.li,{children:"Contador mec\xe2nico ou \xf3ptico"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Atuadores"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Motor para abertura/fechamento da armadilha"}),"\n",(0,o.jsx)(n.li,{children:"LED UV para atra\xe7\xe3o de insetos"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"R\xe1dio"}),": NRF24L01+ ou SX1276 (LoRa)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Energia"}),": Bateria LiPo 18650 + Painel Solar 5V"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Caixa"}),": IP65 com funil para insetos"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"software",children:"Software"}),"\n",(0,o.jsx)(n.h3,{id:"l\xf3gica-de-funcionamento",children:"L\xf3gica de Funcionamento"}),"\n",(0,o.jsx)(n.mermaid,{value:"stateDiagram-v2\r\n    [*] --\x3e Inicializa\xe7\xe3o\r\n    Inicializa\xe7\xe3o --\x3e AtivarLED\r\n    AtivarLED --\x3e MonitorarSensor\r\n    MonitorarSensor --\x3e ContarInseto: Detec\xe7\xe3o\r\n    ContarInseto --\x3e EnviarDados: Timer ou Contador\r\n    EnviarDados --\x3e DeepSleep\r\n    DeepSleep --\x3e Acordar: Timer\r\n    Acordar --\x3e AtivarLED"}),"\n",(0,o.jsx)(n.h3,{id:"c\xf3digo-principal-pseudoc\xf3digo",children:"C\xf3digo Principal (Pseudoc\xf3digo)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cpp",children:'#include <ESP32WiFi.h>\r\n#include <RF24.h>\r\n\r\n// Configura\xe7\xf5es\r\n#define NODE_ID "ARM_01"\r\n#define SENSOR_PIN 34\r\n#define LED_PIN 12\r\n#define RADIO_CE 22\r\n#define RADIO_CS 21\r\n\r\nRF24 radio(RADIO_CE, RADIO_CS);\r\nvolatile int contador = 0;\r\nunsigned long ultimoEnvio = 0;\r\n\r\nvoid IRAM_ATTR contarInseto() {\r\n    contador++;\r\n}\r\n\r\nvoid setup() {\r\n    Serial.begin(115200);\r\n    pinMode(SENSOR_PIN, INPUT);\r\n    pinMode(LED_PIN, OUTPUT);\r\n    attachInterrupt(digitalPinToInterrupt(SENSOR_PIN), contarInseto, RISING);\r\n\r\n    radio.begin();\r\n    radio.setChannel(76);\r\n    radio.openWritingPipe(0xF0F0F0F0E1LL);\r\n    radio.setPALevel(RF24_PA_LOW);\r\n    radio.stopListening();\r\n}\r\n\r\nvoid loop() {\r\n    digitalWrite(LED_PIN, HIGH);  // Ativar LED UV\r\n\r\n    // Enviar dados a cada 1 hora ou quando contador > 10\r\n    if (millis() - ultimoEnvio > 3600000 || contador > 10) {\r\n        String data = "{";\r\n        data += "\\"node_id\\":\\"" + String(NODE_ID) + "\\",";\r\n        data += "\\"tipo\\":\\"armadilha\\",";\r\n        data += "\\"evento\\":\\"contagem\\",";\r\n        data += "\\"contador\\":" + String(contador) + ",";\r\n        data += "\\"timestamp\\":\\"" + getTimestamp() + "\\",";\r\n        data += "\\"sync\\":false";\r\n        data += "}";\r\n\r\n        radio.write(data.c_str(), data.length());\r\n        ultimoEnvio = millis();\r\n        contador = 0;  // Reset contador ap\xf3s envio\r\n    }\r\n\r\n    // Deep Sleep por 5 minutos\r\n    esp_sleep_enable_timer_wakeup(5 * 60 * 1000000);\r\n    digitalWrite(LED_PIN, LOW);\r\n    esp_deep_sleep_start();\r\n}\r\n\r\nString getTimestamp() {\r\n    return "2025-12-28T10:00:00";\r\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"formato-de-dados",children:"Formato de Dados"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "node_id": "ARM_01",\r\n  "tipo": "armadilha",\r\n  "evento": "contagem",\r\n  "contador": 15,\r\n  "timestamp": "2025-12-28T10:00:00",\r\n  "sync": false\r\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"gateway---processamento",children:"Gateway - Processamento"}),"\n",(0,o.jsx)(n.p,{children:"Semelhante \xe0 esta\xe7\xe3o meteorol\xf3gica, mas com foco em contagem acumulada."}),"\n",(0,o.jsx)(n.h3,{id:"c\xf3digo-espec\xedfico",children:"C\xf3digo Espec\xedfico"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"# No loop do gateway\r\ndef processar_armadilha(dados):\r\n    # Agregar contagens por dia\r\n    cursor.execute('SELECT SUM(contador) FROM dados WHERE node_id = ? AND tipo = ? AND DATE(timestamp) = DATE(?)',\r\n                   (dados['node_id'], 'armadilha', dados['timestamp'][:10]))\r\n    total = cursor.fetchone()[0] or 0\r\n    total += dados['contador']\r\n    \r\n    # Salvar ou atualizar\r\n    cursor.execute('INSERT OR REPLACE INTO contagens_diarias (node_id, data, total) VALUES (?, ?, ?)',\r\n                   (dados['node_id'], dados['timestamp'][:10], total))\r\n    conn.commit()\n"})}),"\n",(0,o.jsx)(n.h2,{id:"api-do-servidor",children:"API do Servidor"}),"\n",(0,o.jsx)(n.h3,{id:"endpoint-post-apidados",children:"Endpoint: POST /api/dados"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Exemplo de Request:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "node_id": "ARM_01",\r\n  "tipo": "armadilha",\r\n  "evento": "contagem",\r\n  "contador": 15,\r\n  "timestamp": "2025-12-28T10:00:00",\r\n  "sync": false\r\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Resposta:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "message": "Contagem de insetos registrada"\r\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"pr\xf3ximos-passos",children:"Pr\xf3ximos Passos"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Otimizar consumo de energia do LED UV"}),"\n",(0,o.jsx)(n.li,{children:"Adicionar c\xe2mera para identifica\xe7\xe3o de insetos"}),"\n",(0,o.jsx)(n.li,{children:"Alertas autom\xe1ticos quando contagem exceder threshold"}),"\n",(0,o.jsx)(n.li,{children:"Integra\xe7\xe3o com modelos de previs\xe3o de pragas"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);