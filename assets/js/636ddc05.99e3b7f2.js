"use strict";(globalThis.webpackChunkagrono_docs=globalThis.webpackChunkagrono_docs||[]).push([[8382],{8070(e,r,n){n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"gateway","title":"Gateway AgroN\xf3","description":"Gateway AgroN\xf3","source":"@site/docs/gateway.md","sourceDirName":".","slug":"/gateway","permalink":"/AgroNo/docs/gateway","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Sensor de Solo","permalink":"/AgroNo/docs/nodes/soil-sensor"},"next":{"title":"API do Servidor AgroN\xf3","permalink":"/AgroNo/docs/server-api"}}');var o=n(4848),a=n(8453);const i={},d="Gateway AgroN\xf3",l={},t=[{value:"Hardware",id:"hardware",level:2},{value:"Software",id:"software",level:2},{value:"Arquitetura",id:"arquitetura",level:3},{value:"Componentes Principais",id:"componentes-principais",level:3},{value:"C\xf3digo Principal (Python)",id:"c\xf3digo-principal-python",level:3},{value:"Banco de Dados Local",id:"banco-de-dados-local",level:2},{value:"Tabelas Principais",id:"tabelas-principais",level:3},{value:"Exemplo de Schema",id:"exemplo-de-schema",level:3},{value:"API do Servidor",id:"api-do-servidor",level:2},{value:"Endpoint: POST /api/dados",id:"endpoint-post-apidados",level:3},{value:"Monitoramento e Manuten\xe7\xe3o",id:"monitoramento-e-manuten\xe7\xe3o",level:2},{value:"Pr\xf3ximos Passos",id:"pr\xf3ximos-passos",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"gateway-agron\xf3",children:"Gateway AgroN\xf3"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"/AgroNo/img/gateway.svg",alt:"Gateway AgroN\xf3"})}),"\n",(0,o.jsx)(r.p,{children:"O gateway \xe9 o componente central do sistema AgroN\xf3, respons\xe1vel por receber dados dos n\xf3s IoT via r\xe1dio, armazenar localmente e sincronizar com o servidor quando a internet estiver dispon\xedvel."}),"\n",(0,o.jsx)(r.h2,{id:"hardware",children:"Hardware"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Computador"}),": Raspberry Pi 4 ou similar"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"R\xe1dio"}),": NRF24L01+ ou SX1276 (LoRa) + adaptador USB/SPI"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Conectividade"}),": Wi-Fi, Ethernet, 4G/LTE (opcional)"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Armazenamento"}),": SD Card ou SSD"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Energia"}),": Fonte 5V USB ou bateria com UPS"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"software",children:"Software"}),"\n",(0,o.jsx)(r.h3,{id:"arquitetura",children:"Arquitetura"}),"\n",(0,o.jsx)(r.mermaid,{value:"graph TD\r\n    A[R\xe1dio NRF24/LoRa] --\x3e B[Receptor Python]\r\n    B --\x3e C[Validador JSON]\r\n    C --\x3e D[Armazenamento Local]\r\n    D --\x3e E[Verificador Internet]\r\n    E --\x3e|Online| F[Sincronizador]\r\n    E --\x3e|Offline| G[Buffer Offline]\r\n    F --\x3e H[API Servidor]\r\n    H --\x3e I[ACK]\r\n    I --\x3e J[Marcar Sincronizado]"}),"\n",(0,o.jsx)(r.h3,{id:"componentes-principais",children:"Componentes Principais"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Receptor de R\xe1dio"}),": Escuta continuamente por mensagens"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Processador de Dados"}),": Valida e formata dados recebidos"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Armazenamento Local"}),": SQLite para persist\xeancia offline"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Sincronizador"}),": Envia dados para servidor quando online"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Monitor de Conectividade"}),": Verifica status da internet"]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"c\xf3digo-principal-python",children:"C\xf3digo Principal (Python)"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-python",children:"import json\r\nimport sqlite3\r\nimport requests\r\nimport time\r\nfrom RF24 import RF24\r\n\r\n# Configura\xe7\xf5es\r\nDB_PATH = 'agrono.db'\r\nAPI_URL = 'http://servidor-agrono.com/api/dados'\r\nRADIO_CHANNEL = 76\r\nPIPE_ADDRESS = 0xF0F0F0F0E1LL\r\n\r\nclass AgroNoGateway:\r\n    def __init__(self):\r\n        self.radio = RF24(22, 0)  # GPIO 22 CE, SPI CE0\r\n        self.setup_radio()\r\n        self.setup_database()\r\n        \r\n    def setup_radio(self):\r\n        self.radio.begin()\r\n        self.radio.setChannel(RADIO_CHANNEL)\r\n        self.radio.openReadingPipe(1, PIPE_ADDRESS)\r\n        self.radio.startListening()\r\n        \r\n    def setup_database(self):\r\n        self.conn = sqlite3.connect(DB_PATH)\r\n        self.cursor = self.conn.cursor()\r\n        self.cursor.execute('''CREATE TABLE IF NOT EXISTS dados (\r\n            id INTEGER PRIMARY KEY,\r\n            node_id TEXT,\r\n            tipo TEXT,\r\n            dados TEXT,\r\n            timestamp TEXT,\r\n            sync INTEGER DEFAULT 0\r\n        )''')\r\n        self.conn.commit()\r\n        \r\n    def receber_dados(self):\r\n        if self.radio.available():\r\n            length = self.radio.getDynamicPayloadSize()\r\n            received_payload = self.radio.read(length)\r\n            try:\r\n                dados = json.loads(received_payload.decode('utf-8'))\r\n                self.processar_dados(dados)\r\n            except Exception as e:\r\n                print(f\"Erro ao processar dados: {e}\")\r\n                \r\n    def processar_dados(self, dados):\r\n        # Salvar no banco\r\n        self.cursor.execute('INSERT INTO dados (node_id, tipo, dados, timestamp) VALUES (?, ?, ?, ?)',\r\n                           (dados['node_id'], dados['tipo'], json.dumps(dados), dados['timestamp']))\r\n        self.conn.commit()\r\n        \r\n        # Processamento espec\xedfico por tipo\r\n        if dados['tipo'] == 'meteorologia':\r\n            self.processar_meteorologia(dados)\r\n        elif dados['tipo'] == 'armadilha':\r\n            self.processar_armadilha(dados)\r\n        elif dados['tipo'] == 'solo':\r\n            self.processar_solo(dados)\r\n            \r\n    def processar_meteorologia(self, dados):\r\n        # Agregar dados meteorol\xf3gicos\r\n        pass\r\n        \r\n    def processar_armadilha(self, dados):\r\n        # Agregar contagens de insetos\r\n        pass\r\n        \r\n    def processar_solo(self, dados):\r\n        # Calcular m\xe9dias de solo\r\n        pass\r\n        \r\n    def verificar_internet(self):\r\n        try:\r\n            requests.get('http://www.google.com', timeout=5)\r\n            return True\r\n        except:\r\n            return False\r\n            \r\n    def sincronizar(self):\r\n        if not self.verificar_internet():\r\n            return\r\n            \r\n        self.cursor.execute('SELECT * FROM dados WHERE sync = 0 LIMIT 10')\r\n        rows = self.cursor.fetchall()\r\n        \r\n        for row in rows:\r\n            try:\r\n                dados = json.loads(row[3])\r\n                response = requests.post(API_URL, json=dados, timeout=10)\r\n                if response.status_code == 200:\r\n                    self.cursor.execute('UPDATE dados SET sync = 1 WHERE id = ?', (row[0],))\r\n            except Exception as e:\r\n                print(f\"Erro na sincroniza\xe7\xe3o: {e}\")\r\n                break  # Parar se houver erro\r\n                \r\n        self.conn.commit()\r\n        \r\n    def run(self):\r\n        while True:\r\n            self.receber_dados()\r\n            self.sincronizar()\r\n            time.sleep(1)\r\n\r\nif __name__ == '__main__':\r\n    gateway = AgroNoGateway()\r\n    gateway.run()\n"})}),"\n",(0,o.jsx)(r.h2,{id:"banco-de-dados-local",children:"Banco de Dados Local"}),"\n",(0,o.jsx)(r.h3,{id:"tabelas-principais",children:"Tabelas Principais"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"dados"}),": Armazenamento bruto dos dados recebidos"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"medias_meteorologicas"}),": Agrega\xe7\xe3o de dados meteorol\xf3gicos"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"contagens_armadilhas"}),": Contagens di\xe1rias de insetos"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"medias_solo"}),": M\xe9dias hor\xe1rias de par\xe2metros do solo"]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"exemplo-de-schema",children:"Exemplo de Schema"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"CREATE TABLE dados (\r\n    id INTEGER PRIMARY KEY,\r\n    node_id TEXT,\r\n    tipo TEXT,\r\n    dados TEXT,\r\n    timestamp TEXT,\r\n    sync INTEGER DEFAULT 0\r\n);\r\n\r\nCREATE TABLE medias_meteorologicas (\r\n    id INTEGER PRIMARY KEY,\r\n    node_id TEXT,\r\n    data_hora TEXT,\r\n    temperatura_avg REAL,\r\n    umidade_avg REAL,\r\n    pressao_avg REAL,\r\n    vento_avg REAL,\r\n    chuva_total REAL,\r\n    count INTEGER\r\n);\n"})}),"\n",(0,o.jsx)(r.h2,{id:"api-do-servidor",children:"API do Servidor"}),"\n",(0,o.jsx)(r.h3,{id:"endpoint-post-apidados",children:"Endpoint: POST /api/dados"}),"\n",(0,o.jsx)(r.p,{children:"O gateway envia os dados coletados para este endpoint."}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"Headers:"})}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Content-Type: application/json"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"Corpo da Requisi\xe7\xe3o:"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-json",children:'{\r\n  "node_id": "MET_01",\r\n  "tipo": "meteorologia",\r\n  "temperatura": 25.5,\r\n  "umidade": 65.2,\r\n  "pressao": 1013.25,\r\n  "vento": 12.5,\r\n  "chuva": 0.0,\r\n  "timestamp": "2025-12-28T10:00:00",\r\n  "sync": false\r\n}\n'})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"Resposta de Sucesso:"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "message": "Dados recebidos e processados",\r\n  "id": 12345\r\n}\n'})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"Resposta de Erro:"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-json",children:'{\r\n  "status": "error",\r\n  "message": "Erro ao processar dados",\r\n  "details": "Campo \'node_id\' obrigat\xf3rio"\r\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"monitoramento-e-manuten\xe7\xe3o",children:"Monitoramento e Manuten\xe7\xe3o"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Logs"}),": Registrar todas as opera\xe7\xf5es"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Status"}),": Endpoint para verificar sa\xfade do gateway"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Reinicializa\xe7\xe3o"}),": Script para restart autom\xe1tico"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Backup"}),": Sincroniza\xe7\xe3o peri\xf3dica de dados cr\xedticos"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"pr\xf3ximos-passos",children:"Pr\xf3ximos Passos"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Implementar compress\xe3o de dados para economia de banda"}),"\n",(0,o.jsx)(r.li,{children:"Adicionar autentica\xe7\xe3o com o servidor"}),"\n",(0,o.jsx)(r.li,{children:"Suporte a m\xfaltiplos canais de r\xe1dio"}),"\n",(0,o.jsx)(r.li,{children:"Interface web local para configura\xe7\xe3o"}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);